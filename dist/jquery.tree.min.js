/*! jQuery Tree - v0.1.0 - 2013-07-01
* https://github.com/amazingSurge/jquery-tree
* Copyright (c) 2013 amazingSurge; Licensed GPL */
(function(t){var e=function(){var e=function(t){this.tpl=t.tpl};return e.prototype={constructor:e,getLeaf:function(t){return t.html()},getBranch:function(t){return t.children("div").html()},renderTree:function(e,n,i){var r,a=this;if(n?(r=e,e.addClass("tree")):r=e.children("ul"),0!==r.length){e.addClass("tree-branch");var o=function(e){e.children("li").each(function(e,n){var r=t(n),o=a.tpl.branch(a.getBranch(r));r.children("div").replaceWith(o),a.renderTree(r,!1,i)})};o(r)}}},e}(),n=function(){var t=function(t){this.tpl=t.tpl};return t.prototype={constructor:t,getLeaf:function(t){var e=this.tpl.leaf(t);return"<li>"+e+"</li>"},getBranch:function(t){var e=this.tpl.branch(t),n=this.getTree(t.children);return'<li class="tree-branch">'+e+n+"</li>"},getNode:function(t){return t.children?this.getBranch(t):this.getLeaf(t)},getTree:function(t,e){var n="";for(var i in t)n+=this.getNode(t[i]);return e?'<ul class="tree">'+n+"</ul>":"<ul>"+n+"</ul>"}},t}(),i=function(){var e=function(t,e,n){this.$dom=t,this.api=n,null==e&&(e=!1),this.position=[],e?this.type="root":(this.selected=!1,this.hasChildren()?(this.type="branch",this.opened=!1):this.type="leaf"),this.init()};return e.prototype={init:function(){switch(this.type){case"root":this.children=this.$dom.get(0).children,this.level=0,this.$parent=null;break;case"branch":case"leaf":var t=this.$dom.children("ul");t.length>0&&(this.children=t.get(0).children),this.$parent=this.$dom.parents("li.tree-branch").eq(0),0===this.$parent.length&&(this.$parent=this.$dom.parent()),this.parent=this.$parent.data("node"),this.level=this.parent.level+1}},getDom:function(){return this.$dom},getParent:function(){return this.$parent},getChildren:function(){return t(this.children)},hasChildren:function(){return 0!==this.$dom.children("ul").children("li").length},open:function(t){if(this.opened=!0,this.$dom.addClass("tree-open"),this.childrenSelect(),t){var e=function(t){t.parent&&(t.parent.open(!0),e(t.parent))};e(this)}},close:function(e){if(this.opened=!1,this.$dom.removeClass("tree-open"),this.childrenSelect(),e){var n=function(e){for(var n=0;e.children.length>n;n++){var i=e.children[n],r=t(i),a=r.data("node");"branch"===a.type&&a.close(!0)}};n(this)}},childrenSelect:function(){this.$dom.find("li").hasClass("tree-selected")&&this.$dom[this.opened?"removeClass":"addClass"]("children-selected")},toggle:function(){this.opened?this.close():this.open()},select:function(e){e.each(function(e,n){var i=t(n);i.data("node").selected=!1,i.removeClass("children-selected"),i.removeClass("tree-selected")}),this.selected=!0,this.$dom.addClass("tree-selected")},switchType:function(t){if("leaf"===t.type){var e=this.$dom.html();t.$dom.addClass("tree-branch"),t.$dom.html(this.api.options.tpl.branch(e)+"<ul></ul>")}},append:function(e){var n=this.api.dataParser.getNode(e);this.switchType(this.$dom.data("node"));var i=t(n).appendTo(this.$dom.children("ul"));return"leaf"===this.type?this.api.attach(this.$dom,!1,this.api):this.api.attach(i,!1,this.api),this},prepend:function(e){var n=this.api.dataParser.getNode(e);this.switchType(this.$dom.data("node"));var i=t(n).prependTo(this.$dom.children("ul"));return"leaf"===this.type?this.api.attach(this.$dom,!1,this.api):this.api.attach(i,!1,this.api),this},after:function(e){var n=this.api.dataParser.getNode(e);this.$dom.after(t(n));var i=this.$dom.next();return this.api.attach(i,!1,this.api),this},before:function(e){var n=this.api.dataParser.getNode(e);this.$dom.before(t(n));var i=this.$dom.prev();return this.api.attach(i,!1,this.api),this},remove:function(){this.$dom.remove()}},e}(),r=function(){var r=t.tree=function(i,a){this.$el=t(i),this.options=t.extend(!0,{},r.defaults,a),this.namespace=this.options.namespace,this.dataParser=new n(this.options),this.htmlParser=new e(this.options),this._init()};return r.defaults={namespace:"tree",autoOpen:[1,2],dataFromHtml:!1,data:null,tpl:{toggler:function(){return'<i class="tree-toggler"></i>'},branch:function(t){var e=this.branchContent(t),n=this.toggler(t);return'<div class="tree-element">'+n+'<div class="element-content">'+e+"</div>"+"</div>"},branchContent:function(t){return"object"==typeof t?t.name:t},leaf:function(t){var e=this.leafContent(t);return e},leafContent:function(t){return"object"==typeof t?t.name:t}},onTogglerClick:function(){},onBranchClick:function(){},onLeafClick:function(){}},r.prototype={constructor:r,_init:function(){this.options.dataFromHtml===!0?this._createFromHtml():this._createFromData();var e="ul"===this.$el[0].nodeName.toLowerCase()?this.$el:this.$el.find("ul:first");this.root=e.data("node"),console.log(typeof this.options.autoOpen),this.autoOpen(),this.$el.on({click:t.proxy(this._click,this)})},open:function(t,e){var n=this.get(t);return n?n.open(e):void 0},close:function(t,e){var n=this.get(t);return n?n.close(e):void 0},select:function(t){var e=this.get(t);return e?e.select(this.$el.find("li")):void 0},get:function(e){t.isArray(e)||(e=[]);try{var n=function(e,n){return t(e.children[n]).data("node")},i=this.root;for(var r in e)i=n(i,e[r]-1)}catch(a){return null}return i},getRoot:function(){return this.root},autoOpen:function(){var e=this,n=this.root.$dom;switch(typeof e.options.autoOpen){case"boolean":n.find("li").each(function(n,i){var r=t(i),a=r.data("node");e.options.autoOpen===!0&&"branch"===a.type&&a.open()});break;case"number":n.find("li").each(function(n,i){var r=t(i),a=r.data("node");"branch"===a.type&&a.level<=e.options.autoOpen&&a.open()});break;case"object":t.isArray(e.options.autoOpen)&&e.get(e.options.autoOpen).open(!0)}},append:function(t,e){var n=this.get(t);return n?n.append(e):void 0},prepend:function(t,e){var n=this.get(t);return n?n.prepend(e):void 0},after:function(t,e){var n=this.get(t);return n?n.after(e):void 0},before:function(t,e){var n=this.get(t);return n?n.before(e):void 0},remove:function(t){var e=this.get(t);return e?e.remove(data):void 0},attach:function(e,n,r){var a=this;e.data("node",new i(e,n,r));var o;if(o=n?e:e.children("ul"),0!==o.length){var s=function(e){e.children("li").each(function(e,n){var i=t(n);a.attach(i,!1,r)})};s(o)}},_createFromData:function(){var t="";this.options.data&&(t=this.dataParser.getTree(this.options.data,!0)),this.$el.html(t),this.attach(this.$el.children("ul"),!0,this)},_createFromHtml:function(){var t="ul"===this.$el[0].nodeName.toLowerCase()?this.$el:this.$el.find("ul:first");this.htmlParser.renderTree(t,!0,this),this.attach(t,!0,this)},_click:function(e){var n=t(e.target).closest(".tree-toggler, li");switch($node=t(e.target).closest("li"),node=$node.data("node"),n.attr("class")){case"tree-toggler":node.toggle();break;default:node.select(this.$el.find("li"))}}},r}();t.fn.tree=function(e){if("string"!=typeof e)return this.each(function(){t.data(this,"tree")||t.data(this,"tree",new r(this,e))});var n=e,i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(!/^()$/.test(n))return this.each(function(){var e=t.data(this,"tree");e&&"function"==typeof e[n]&&e[n].apply(e,i)});var a=this.first().data("tree");return a&&"function"==typeof a[n]?a[n].apply(a,i):void 0}})(jQuery);