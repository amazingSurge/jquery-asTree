/*! jQuery Tree - v0.2.0 - 2013-07-24
* https://github.com/amazingSurge/jquery-tree
* Copyright (c) 2013 amazingSurge; Licensed GPL */
!function(a){var b=function(){var b=function(a){this.tpl=a.tpl};return b.prototype={constructor:b,getLeaf:function(a){return a.html()},getBranch:function(a){return a.children("div").html()},renderTree:function(b,c,d){var e,f=this;if(c?(e=b,b.addClass("tree")):e=b.children("ul"),0!==e.length){b.addClass("tree-branch");var g=function(b){b.children("li").each(function(b,c){var e=a(c),g=f.tpl.branch(f.getBranch(e));e.children("div").replaceWith(g),f.renderTree(e,!1,d)})};g(e)}}},b}(),c=function(){var a=function(a){this.tpl=a.tpl};return a.prototype={constructor:a,getLeaf:function(a){var b=this.tpl.leaf(a);return"<li>"+b+"</li>"},getBranch:function(a){var b=this.tpl.branch(a),c=this.getTree(a.children);return'<li class="tree-branch">'+b+c+"</li>"},getNode:function(a){return a.children?this.getBranch(a):this.getLeaf(a)},getTree:function(a,b){var c="";for(var d in a)c+=this.getNode(a[d]);return b?'<ul class="tree">'+c+"</ul>":"<ul>"+c+"</ul>"}},a}(),d=function(){var b=function(a,b,c){this.$dom=a,this.api=c,null==b&&(b=!1),b?this.type="root":(this.selected=!1,this.hasChildren()?(this.type="branch",this.opened=this.isOpened()):this.type="leaf"),this.init()};return b.prototype={init:function(){switch(this.type){case"root":this._children=this.$dom.get(0).children,this.level=0,this.parent=null,this.$parent=null;break;case"branch":case"leaf":var a=this.$dom.children("ul");this._children=a.length>0?a.get(0).children:[],this.$parent=this.$dom.parents("li.tree-branch").eq(0),0===this.$parent.length&&(this.$parent=this.$dom.parent()),this.parent=this.$parent.data("node"),this.level=this.parent.level+1}},get:function(){return this.$dom},position:function(){var a=[],b=function(c){a.push(c.$dom.index()+1),c.parent&&"root"!==c.parent.type&&b(c.parent)};return b(this),a.reverse()},parents:function(){var a=[],b=function(c){null!==c.parent&&(a.push(c.parent),b(c.parent))};return b(this),a},children:function(){for(var b,c=[],d=0;d<this._children.length;d++)b=a(this._children[d]).data("node"),b&&c.push(b);return c},siblings:function(){for(var a,b=[],c=this.$dom.siblings(),d=0;d<c.length;d++)a=c.data("node"),a&&b.push(a);return b},hasChildren:function(){return 0!==this.$dom.children("ul").children("li").length},isOpened:function(){return"undefined"==typeof this.opened?this.$dom.is(".tree_open"):this.opened},open:function(a){if(this.opened=!0,this.$dom.addClass("tree_open"),a)for(var b=this.parents(),c=0;c<b.length;c++)"root"!==b[c].type&&b[c].open();return!this.api.options.multiSelect&&this.hasChildrenSelect()&&this.$dom.removeClass("tree_childrenSelected"),this},close:function(a){if(this.opened=!1,this.$dom.removeClass("tree_open"),a)for(var b=this.children(),c=0;c<b.length;c++)"branch"===b[c].type&&b[c].close(!0);return!this.api.options.multiSelect&&this.hasChildrenSelect()&&this.$dom.addClass("tree_childrenSelected"),this},hasChildrenSelect:function(){return 0!==this.$dom.find("li.tree_selected").length},hasChildrenSelectBranch:function(){return 0!==this.api.$el.find("li.tree_childrenSelected").length},toggleOpen:function(){return this.opened?this.close():this.open(),this},toggleSelect:function(){return this.selected?this.unselect():this.select(),this},select:function(){return this.selected=!0,this.$dom.addClass("tree_selected"),this.api.options.multiSelect?this.api.selected.push(this):(this.api.selected&&this.api.selected.unselect(!0),this.api.selected=this),!this.api.options.multiSelect&&this.hasChildrenSelectBranch()&&this.api.$el.find("li.tree_childrenSelected").removeClass("tree_childrenSelected"),this},unselect:function(b){if(this.api.options.canUnselect||b)if(this.selected=!1,this.$dom.removeClass("tree_selected"),this.api.options.multiSelect){var c=this;this.api.selected=a.grep(this.api.selected,function(a){return a.$dom!==c.$dom})}else this.api.selected=null;return this},toBranch:function(){if("leaf"===this.type){var a=this.$dom.html();this.$dom.addClass("tree-branch"),this.$dom.html(this.api.options.tpl.branch(a)+"<ul></ul>")}return this},append:function(b){"leaf"===this.type&&this.toBranch();var c=this.api.dataParser.getNode(b),d=a(c).appendTo(this.$dom.children("ul"));return"leaf"===this.type?this.api.attach(this.$dom,!1,this.api):this.api.attach(d,!1,this.api),this},prepend:function(b){"leaf"===this.type&&this.toBranch();var c=this.api.dataParser.getNode(b),d=a(c).prependTo(this.$dom.children("ul"));return"leaf"===this.type?this.api.attach(this.$dom,!1,this.api):this.api.attach(d,!1,this.api),this},after:function(a){var b=this.api.dataParser.getNode(a);this.$dom.after(b);var c=this.$dom.next();return this.api.attach(c,!1,this.api),this},before:function(a){var b=this.api.dataParser.getNode(a);this.$dom.before(b);var c=this.$dom.prev();return this.api.attach(c,!1,this.api),this},remove:function(){return this.$dom.remove(),this}},b}(),e=function(){var e=a.tree=function(d,f){this.$el=a(d),this.options=a.extend(!0,{},e.defaults,f),this.namespace=this.options.namespace,this.dataParser=new c(this.options),this.htmlParser=new b(this.options),this._init()};return e.defaults={namespace:"tree",autoOpen:[1,2],dataFromHtml:!1,data:null,multiSelect:!1,canUnselect:!0,tpl:{toggler:function(){return'<i class="tree-toggler"></i>'},branch:function(a){var b=this.branchContent(a),c=this.toggler(a);return'<div class="tree-element">'+c+'<div class="element-content">'+b+"</div>"+"</div>"},branchContent:function(a){return"object"==typeof a?a.name:a},leaf:function(a){var b=this.leafContent(a);return b},leafContent:function(a){return"object"==typeof a?a.name:a}}},e.prototype={constructor:e,_init:function(){this.options.dataFromHtml===!0?this._createFromHtml():this._createFromData();var b="ul"===this.$el[0].nodeName.toLowerCase()?this.$el:this.$el.find("ul:first");this.root=b.data("node"),this.selected=this.options.multiSelect?[]:null,this.autoOpen(),this.$el.on({click:a.proxy(this._click,this)})},_createFromHtml:function(){var a="ul"===this.$el[0].nodeName.toLowerCase()?this.$el:this.$el.find("ul:first");this.htmlParser.renderTree(a,!0,this),this.attach(a,!0,this)},_createFromData:function(){var a="";this.options.data&&(a=this.dataParser.getTree(this.options.data,!0)),this.$el.html(a),this.attach(this.$el.children("ul"),!0,this)},_click:function(b){var c=a(b.target).closest(".tree-toggler, li"),d=a(b.target).closest("li"),e=d.data("node");switch(c.attr("class")){case"tree-toggler":e.toggleOpen();break;default:e.toggleSelect()}},attach:function(b,c,e){var f=this;b.data("node",new d(b,c,e));var g;if(g=c?b:b.children("ul"),0!==g.length){var h=function(b){b.children("li").each(function(b,c){var d=a(c);f.attach(d,!1,e)})};h(g)}},open:function(a,b){var c=this.get(a);return c&&c.open(b),this},close:function(a,b){var c=this.get(a);return c&&c.close(b),this},select:function(a){var b=this.get(a);return b&&b.select(),this},unselect:function(a){var b=this.get(a);return b&&b.unselect(),this},get:function(b){a.isArray(b)||(b=[]);try{for(var c=function(b,c){return a(b._children[c]).data("node")},d=this.root,e=0;e<b.length;e++)d=c(d,b[e]-1)}catch(f){return null}return d},getRoot:function(){return this.root},getSelected:function(){return this.selected},autoOpen:function(){var b=this,c=this.root.$dom;switch(typeof b.options.autoOpen){case"boolean":c.find("li").each(function(c,d){var e=a(d),f=e.data("node");b.options.autoOpen===!0&&"branch"===f.type&&f.open()});break;case"number":c.find("li").each(function(c,d){var e=a(d),f=e.data("node");"branch"===f.type&&f.level<=b.options.autoOpen&&f.open()});break;case"object":a.isArray(b.options.autoOpen)&&this.get(b.options.autoOpen).open(!0)}},append:function(a,b){var c=this.get(a);return c&&c.append(b),this},prepend:function(a,b){var c=this.get(a);return c&&c.prepend(b),this},after:function(a,b){var c=this.get(a);return c&&c.after(b),this},before:function(a,b){var c=this.get(a);return c&&c.before(b),this},remove:function(a){var b=this.get(a);return b&&b.remove(data),this}},e}();a.fn.tree=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,"tree")||a.data(this,"tree",new e(this,b))});var c=b,d=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(!/^(getRoot|get|getSelected)$/.test(c))return this.each(function(){var b=a.data(this,"tree");b&&"function"==typeof b[c]&&b[c].apply(b,d)});var f=this.first().data("tree");return f&&"function"==typeof f[c]?f[c].apply(f,d):void 0}}(jQuery);